(this["webpackJsonpsudoku-solver"]=this["webpackJsonpsudoku-solver"]||[]).push([[0],{23:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var r=n(0),c=n.n(r),a=n(3),i=n(6),o=n(7),s=n(8),u=n(16),l=n.n(u),d=n(33),h=n.n(d),v=n(21),f=function(){function t(n){Object(o.a)(this,t),this.scheduler=void 0,this.language="eng",this.config={threadCount:2,whiteList:"",single:!1},this.getTesseractConfig=function(){return{tesseractConfig:{tessedit_ocr_engine_mode:2,user_defined_dpi:"300",tessedit_pageseg_mode:"10",tessedit_char_whitelist:"123456789"},workerConfig:l.a?{langPath:h.a.join(e,"..","..","..","public","ocr"),cacheMethod:"none",gzip:!0}:{langPath:"".concat("/sudoku-solver","/ocr"),workerPath:"".concat("/sudoku-solver","/ocr/worker.min.js"),corePath:"".concat("/sudoku-solver","/ocr/tesseract-core.wasm.js")}}},this.config=Object(i.a)(Object(i.a)({},this.config),n),this.scheduler=Object(v.createScheduler)()}return Object(s.a)(t,[{key:"load",value:function(){var e=Object(a.a)(c.a.mark((function e(){var t,n,r,i,o=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getTesseractConfig(),n=t.workerConfig,r=t.tesseractConfig,i=function(){var e=Object(a.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(v.createWorker)(n),e.next=3,t.load();case 3:return e.next=5,t.loadLanguage(o.language);case 5:return e.next=7,t.initialize(o.language);case 7:return e.next=9,t.setParameters(r);case 9:o.scheduler.addWorker(t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=4,Promise.allSettled(Array(this.config.threadCount).fill(0).map(i));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=Object(a.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.scheduler.addJob("recognize",t);case 2:return n=e.sent,r=n.data,e.abrupt("return",this.config.single?r.text.slice(0,1):r.text);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"destruct",value:function(){var e=Object(a.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.scheduler.terminate();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}()}).call(this,"/")},32:function(e,t,n){e.exports={app:"App_app__2ziFi"}},34:function(e,t,n){e.exports={sudokuSolver:"SudokuSolver_sudokuSolver__10dvD"}},35:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);n(35);var r,c=n(2),a=n.n(c),i=n(31),o=n.n(i),s=n(4),u=n(32),l=n.n(u),d=n(6),h=n(0),v=n.n(h),f=n(3),p={width:{ideal:4096},height:{ideal:2160},facingMode:{ideal:"environment"},focusMode:{ideal:"continuous"},whiteBalance:{ideal:"continuous"},exposureMode:{ideal:"continuous"}},g=function(){var e=Object(f.a)(v.a.mark((function e(){var t,n,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:if(t=e.sent,(n=t.filter((function(e){return"videoinput"===e.kind}))).length){e.next=6;break}throw new Error("No camera found.");case 6:return r=n.filter((function(e){return e.label.includes("facing back")})),e.abrupt("return",r.length?r[r.length-1]:null);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=Object(f.a)(v.a.mark((function e(t,n){var r,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:return r=e.sent,c={video:Object(d.a)(Object(d.a)({},p),{},{deviceId:(null===r||void 0===r?void 0:r.deviceId)?r.deviceId:void 0},n&&{width:{ideal:n.width},height:{ideal:n.height}}),audio:!1},e.next=6,navigator.mediaDevices.getUserMedia(c);case 6:return t.srcObject=e.sent,e.next=9,t.play();case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),w=n(1);!function(e){e[e.Loading=0]="Loading",e[e.Active=1]="Active",e[e.Denied=2]="Denied",e[e.Unavailable=3]="Unavailable"}(r||(r={}));var m=Object(c.forwardRef)((function(e,t){var n=e.onStatusUpdate;return Object(c.useEffect)((function(){var e=t.current;return e?(b(e,{width:800,height:800}).catch((function(e){var t=e.name;return n("NotAllowedError"===t?r.Denied:r.Unavailable)})),function(){e.srcObject.getVideoTracks()[0].stop()}):function(){}}),[n,t]),Object(w.jsx)("video",{ref:t,onLoadedMetadata:function(){return n(r.Active)},onSuspend:function(){return n(r.Unavailable)},playsInline:!0,muted:!0})})),j=n(7),O=n(8),x=n(16),k=n.n(x),y=function(){var e=Object(f.a)(v.a.mark((function e(t){var n,r,c=arguments;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:1e4,r=document.createElement("script"),t.startsWith("http")?r.src=t:t.startsWith("/")?r.src="".concat("/sudoku-solver").concat(t):r.src="".concat("/sudoku-solver","/").concat(t),document.body.appendChild(r),e.abrupt("return",new Promise((function(e,c){var a=window.setTimeout((function(){return c(new Error("".concat(t," failed to load in time")))}),n);r.addEventListener("load",(function(){window.clearTimeout(a),e()}))})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y("/mobileConsole.js");case 2:eruda.init();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=n(12),C=function(e,t){var n=Object(s.a)(e,2),r=n[0],c=n[1],a=Object(s.a)(t,2),i=a[0],o=a[1];return Math.pow(Math.pow(r-i,2)+Math.pow(c-o,2),.5)},_=function(e,t){var n=t.map((function(t){return C(e,t)})),r=n[0];return t.reduce((function(e,t,c){return n[c]<r?(r=n[c],t):e}))},E=function(e){return e.map((function(t,n){return C(t,e[n<e.length-1?n+1:0])}))},A=function(e,t){return e[0]>=t.x&&e[1]>=t.y&&e[0]<=t.x+t.width&&e[0]<=t.y+t.height},R=function(e){for(var t=Array.from(e.data32S),n=Array(4),r=0;r<4;r++)n[r]=t.slice(2*r,2*r+2);return n},P=function(e){var t=new cv.Mat,n=.01*cv.arcLength(e,!0);return cv.approxPolyDP(e,t,n,!0),t},D=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(4!==e.size().height)return!1;if(!t)return!0;var c=Math.pow(Math.min(t.rows,t.cols),2)*n,a=Math.max(t.rows,t.cols)*r;if(cv.contourArea(e)>=c){var i=R(e),o=E(i).sort(),s=o.pop();return!!s&&(s<a&&o.every((function(e){return e>.7*s})))}return!1},I=function(e,t){var n=[e.cols,e.rows],r=n[0],c=n[1],a=R(t),i=_([0,0],a),o=_([r,0],a),s=_([0,c],a),u=_([r,c],a),l=Math.min(o[0]-i[0],u[0]-s[0]),d=Math.min(s[1]-i[1],u[1]-o[1]),h=cv.Mat.zeros(l,d,cv.CV_8UC3),v=new cv.Size(l,d),f=cv.matFromArray(4,1,cv.CV_32FC2,[].concat(Object(M.a)(i),Object(M.a)(o),Object(M.a)(u),Object(M.a)(s))),p=cv.matFromArray(4,1,cv.CV_32FC2,[0,0,l,0,l,d,0,d]),g=cv.getPerspectiveTransform(f,p);return cv.warpPerspective(e,h,g,v,cv.INTER_LINEAR,cv.BORDER_CONSTANT),g.delete(),f.delete(),p.delete(),h},T=function(e,t,n){for(var r=new Array(t),c=e.cols/n,a=e.rows/t,i=0;i<t;i++){r[i]=new Array(n);for(var o=0;o<n;o++){var s=o*c,u=i*a,l=new cv.Rect(s,u,c,a);r[i][o]=e.roi(l)}}return r},L=function(e,t){var n=[Math.round(t.rows/2),Math.round(t.cols/2)],r=t.rows*t.cols,c=.08*r,a=.8*r,i=new cv.MatVector,o=new cv.Mat;cv.findContours(t,i,o,cv.RETR_TREE,cv.CHAIN_APPROX_SIMPLE),o.delete();for(var s=0,u=null,l=0;l<i.size();l++){var d=i.get(l),h=cv.boundingRect(d),v=h.width*h.height,f=h.width/h.height;v>c&&v<a&&f>.2&&f<1.6&&A(n,h)&&v>s&&(s=v,u=h),d.delete()}if(null!==u){var p=t.roi(u),g=function(e){var t=new cv.Mat(1,4,cv.CV_64F),n=new cv.Mat(1,4,cv.CV_64F);return cv.meanStdDev(e,t,n),t.doubleAt(0,0)>=230}(p);if(p.delete(),!g){var b=Math.round(.05*Math.pow(r,.5));return u.x=Math.max(u.x-b,0),u.y=Math.max(u.y-b,0),u.width=Math.min(u.width+2*b,e.cols-u.x),u.height=Math.min(u.height+2*b,e.rows-u.y),i.delete(),e.roi(u)}}return i.delete(),null},z=function(){function e(t,n){if(Object(j.a)(this,e),this.config={rows:9,columns:9,preprocess:{blurRadius:11,thresholdBlur:5,thresholdNorm:2},minSize:.25,maxSize:.99},this.original=void 0,this.source=void 0,this.processed=void 0,!cv)throw new Error("OpenCV must be loaded!");this.original="ImageData"===t.constructor.name?cv.matFromImageData(t):cv.imread(t),this.source=this.original.clone(),this.config=Object(d.a)(Object(d.a)({},this.config),n)}return Object(O.a)(e,[{key:"extractSudokuImage",value:function(e){this.preprocessImage();var t=this.findLargestSquare();return null!==t?(this.processed={colour:I(this.original,t),binary:I(this.source,t)},t.delete(),this.original.delete(),this.source.delete(),e&&cv.imshow(e,this.processed.colour),!0):(this.processed=null,!1)}},{key:"extractDigits",value:function(){if(null===this.processed)return null;if(void 0===this.processed)return this.extractSudokuImage(),this.extractDigits();for(var e=T(this.processed.colour,this.config.rows,this.config.columns),t=T(this.processed.binary,this.config.rows,this.config.columns),n=[],r=0;r<this.config.rows;r++){for(var c=[],a=0;a<this.config.columns;a++){var i=e[r][a],o=t[r][a],s=L(i,o);if(s){var u=document.createElement("canvas");c.push(u),cv.imshow(u,s),s.delete()}else c.push(null);i.delete(),o.delete()}n.push(c)}return n}},{key:"destruct",value:function(){this.processed?(this.processed.colour.delete(),this.processed.binary.delete()):(this.original.delete(),this.source.delete())}},{key:"preprocessImage",value:function(){var e=this.config.preprocess,t=e.blurRadius,n=e.thresholdBlur,r=e.thresholdNorm;cv.cvtColor(this.source,this.source,cv.COLOR_RGBA2GRAY,0);var c=new cv.Size(t,t);cv.GaussianBlur(this.source,this.source,c,0,0,cv.BORDER_DEFAULT),cv.adaptiveThreshold(this.source,this.source,255,cv.ADAPTIVE_THRESH_MEAN_C,cv.THRESH_BINARY,n,r)}},{key:"findLargestSquare",value:function(){var e=new cv.MatVector,t=new cv.Mat;cv.findContours(this.source,e,t,cv.RETR_TREE,cv.CHAIN_APPROX_SIMPLE);for(var n=0,r=null,c=0;c<e.size();c++){var a=e.get(c),i=P(a);if(D(i,this.source,this.config.minSize,this.config.maxSize)){var o=cv.contourArea(i);o>n&&(n=o,r=i.clone())}a.delete(),i.delete()}return e.delete(),t.delete(),r}}],[{key:"loadDependencies",value:function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k.a&&"undefined"===typeof cv){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.abrupt("return",y("opencv.js",t));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),F=n(23);function N(e){var t=e.source,n=e.onFound,r=e.scanHz,a=void 0===r?30:r,i=Object(c.useState)(!1),o=Object(s.a)(i,2),u=o[0],l=o[1],d=Object(c.useState)(!1),h=Object(s.a)(d,2),v=h[0],f=h[1],p=Object(c.useState)(!1),g=Object(s.a)(p,2),b=g[0],m=g[1],j=Object(c.useState)(null),O=Object(s.a)(j,2),x=O[0],k=O[1],y=Object(c.useRef)(null),S=Object(c.useMemo)((function(){return new F.a({whiteList:"123456789",single:!0})}),[]),M=Object(c.useCallback)((function(){var e=Date.now(),n=!1;if(t&&y.current){var r=function(e){var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var n=t.getContext("2d");return n?(n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height)):null}(t);if(r){var c=new z(r);(n=c.extractSudokuImage(y.current))&&k(c.extractDigits()),c.destruct()}}var i=Date.now()-e;!n&&window.setTimeout(M,1e3/a-i)}),[a,t]),C=Object(c.useCallback)((function(){return x&&Promise.all(x.map((function(e){return Promise.all(e.map((function(e){return e?S.read(e):""})))}))).then(n)}),[x,n,S]);return Object(c.useEffect)((function(){u||(z.loadDependencies().then((function(){M(),f(!0)})),S.load().then((function(){C(),m(!0)})),l(!0))}),[u,C,S,M]),Object(c.useEffect)((function(){b&&C()}),[C,b]),Object(c.useEffect)((function(){return function(){S.destruct()}}),[S]),Object(w.jsxs)("div",{children:[!v&&"Please wait while the scanner loads...",x&&!b&&"Please wait while the reader loads...",Object(w.jsx)("canvas",{ref:y})]})}var B=n(34),V=n.n(B);function H(e){var t=e.sudoku,n=0;return Object(w.jsx)("table",{className:V.a.sudokuSolver,children:Object(w.jsx)("tbody",{children:t.map((function(e){return Object(w.jsx)("tr",{children:e.map((function(e){return Object(w.jsx)("td",{children:e},n++)}))},n)}))})})}function U(){var e=Object(c.useState)(r.Loading),t=Object(s.a)(e,2),n=t[0],a=t[1],i=Object(c.useState)(null),o=Object(s.a)(i,2),u=o[0],d=o[1],h=Object(c.useRef)(null);return Object(w.jsxs)("div",{className:l.a.app,children:[Object(w.jsx)("header",{children:Object(w.jsx)("h1",{children:"\ud83e\uddee Sudoku Solver"})}),Object(w.jsxs)("main",{children:[Object(w.jsx)(m,{ref:h,onStatusUpdate:a}),n===r.Active&&!u&&Object(w.jsx)(N,{source:h.current,scanHz:10,onFound:d}),u&&Object(w.jsx)(H,{sudoku:u})]}),Object(w.jsx)("footer",{children:Object(w.jsx)("nav",{children:u&&Object(w.jsx)("button",{type:"button",onClick:function(){return d(null)},children:"Reset"})})})]})}var W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,72)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(w.jsx)(a.a.StrictMode,{children:Object(w.jsx)(U,{})}),document.getElementById("root")),window.location.search.includes("console")&&S(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),W()}},[[71,1,2]]]);
//# sourceMappingURL=main.3acfc4fb.chunk.js.map