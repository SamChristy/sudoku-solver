(this["webpackJsonpsudoku-solver"]=this["webpackJsonpsudoku-solver"]||[]).push([[0],{15:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return f}));var n=r(0),c=r.n(n),i=r(3),a=r(5),o=r(6),s=r(7),u=r(31),h=r.n(u),l=r(32),d=r.n(l),v=r(33),f=function(){function t(r){Object(o.a)(this,t),this.worker=void 0,this.language="eng",this.tesseractConfig={tessedit_ocr_engine_mode:2,tessedit_pageseg_mode:"10",tessedit_char_whitelist:"0123456789",user_defined_dpi:"300"};var n=h.a?{langPath:d.a.join(e,"..","..","..","public/ocr"),cacheMethod:"none",gzip:!0}:{langPath:"".concat("/sudoku-solver","/ocr"),workerPath:"".concat("/sudoku-solver","/ocr/worker.min.js"),corePath:"".concat("/sudoku-solver","/ocr/tesseract-core.wasm.js")};this.worker=Object(v.createWorker)(n),this.tesseractConfig=Object(a.a)(Object(a.a)({},this.tesseractConfig),r)}return Object(s.a)(t,[{key:"load",value:function(){var e=Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.worker.load();case 2:return e.next=4,this.worker.loadLanguage(this.language);case 4:return e.next=6,this.worker.initialize(this.language);case 6:return e.next=8,this.worker.setParameters(this.tesseractConfig);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"extractSingle",value:function(){var e=Object(i.a)(c.a.mark((function e(t){var r,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.worker.recognize(t);case 2:return r=e.sent,n=r.data,e.abrupt("return",n.text.slice(0,1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"destruct",value:function(){var e=Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.worker.terminate();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}()}).call(this,"/")},34:function(e,t,r){},39:function(e,t,r){},71:function(e,t,r){"use strict";r.r(t);r(34);var n=r(2),c=r.n(n),i=r(29),a=r.n(i),o=r(11),s=(r(39),r(30)),u=r(0),h=r.n(u),l=r(3),d=r(6),v=r(7),f=r(5),g=r(12),p=function(e,t){var r=Object(o.a)(e,2),n=r[0],c=r[1],i=Object(o.a)(t,2),a=i[0],s=i[1];return Math.pow(Math.pow(n-a,2)+Math.pow(c-s,2),.5)},w=function(e,t){var r=t.map((function(t){return p(e,t)})),n=r[0];return t.reduce((function(e,t,c){return r[c]<n?(n=r[c],t):e}))},m=function(e){return e.map((function(t,r){return p(t,e[r<e.length-1?r+1:0])}))},b=function(e,t){return e[0]>=t.x&&e[1]>=t.y&&e[0]<=t.x+t.width&&e[0]<=t.y+t.height},j=function(e){for(var t=Array.from(e.data32S),r=Array(4),n=0;n<4;n++)r[n]=t.slice(2*n,2*n+2);return r},x=function(e){var t=new cv.Mat,r=.01*cv.arcLength(e,!0);return cv.approxPolyDP(e,t,r,!0),t},O=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(4!==e.size().height)return!1;if(!t)return!0;var c=Math.pow(Math.min(t.rows,t.cols),2)*r,i=Math.max(t.rows,t.cols)*n;if(cv.contourArea(e)>=c){var a=j(e),o=m(a).sort(),s=o.pop();return!!s&&(s<i&&o.every((function(e){return e>.7*s})))}return!1},k=function(e,t){var r=[e.cols,e.rows],n=r[0],c=r[1],i=j(t),a=w([0,0],i),o=w([n,0],i),s=w([0,c],i),u=w([n,c],i),h=Math.min(o[0]-a[0],u[0]-s[0]),l=Math.min(s[1]-a[1],u[1]-o[1]),d=cv.Mat.zeros(h,l,cv.CV_8UC3),v=new cv.Size(h,l),f=cv.matFromArray(4,1,cv.CV_32FC2,[].concat(Object(g.a)(a),Object(g.a)(o),Object(g.a)(u),Object(g.a)(s))),p=cv.matFromArray(4,1,cv.CV_32FC2,[0,0,h,0,h,l,0,l]),m=cv.getPerspectiveTransform(f,p);return cv.warpPerspective(e,d,m,v,cv.INTER_LINEAR,cv.BORDER_CONSTANT),m.delete(),f.delete(),p.delete(),d},y=function(e,t,r){for(var n=new Array(t),c=e.cols/r,i=e.rows/t,a=0;a<t;a++){n[a]=new Array(r);for(var o=0;o<r;o++){var s=o*c,u=a*i,h=new cv.Rect(s,u,c,i);n[a][o]=e.roi(h)}}return n},M=function(e,t){var r=[Math.round(t.rows/2),Math.round(t.cols/2)],n=t.rows*t.cols,c=.08*n,i=.8*n,a=new cv.MatVector,o=new cv.Mat;cv.findContours(t,a,o,cv.RETR_TREE,cv.CHAIN_APPROX_SIMPLE),o.delete();for(var s=0,u=null,h=0;h<a.size();h++){var l=a.get(h),d=cv.boundingRect(l),v=d.width*d.height,f=d.width/d.height;v>c&&v<i&&f>.2&&f<1.6&&b(r,d)&&v>s&&(s=v,u=d),l.delete()}if(null!==u){var g=t.roi(u),p=function(e){var t=new cv.Mat(1,4,cv.CV_64F),r=new cv.Mat(1,4,cv.CV_64F);return cv.meanStdDev(e,t,r),t.doubleAt(0,0)>=230}(g);if(g.delete(),!p){var w=Math.round(.05*Math.pow(n,.5));return u.x=Math.max(u.x-w,0),u.y=Math.max(u.y-w,0),u.width=Math.min(u.width+2*w,e.cols-u.x),u.height=Math.min(u.height+2*w,e.rows-u.y),a.delete(),e.roi(u)}}return a.delete(),null},C=function(){function e(t,r){if(Object(d.a)(this,e),this.config={rows:9,columns:9,preprocess:{blurRadius:11,thresholdBlur:5,thresholdNorm:2},minSize:.25,maxSize:.99},this.original=void 0,this.source=void 0,this.processed=void 0,!cv)throw new Error("OpenCV must be loaded!");this.original="ImageData"===t.constructor.name?cv.matFromImageData(t):cv.imread(t),this.source=this.original.clone(),this.config=Object(f.a)(Object(f.a)({},this.config),r)}return Object(v.a)(e,[{key:"extractSudokuImage",value:function(e){this.preprocessImage();var t=this.findLargestSquare();return null!==t?(this.processed={colour:k(this.original,t),binary:k(this.source,t)},t.delete(),this.original.delete(),this.source.delete(),e&&cv.imshow(e,this.processed.colour),!0):(this.processed=null,!1)}},{key:"extractDigits",value:function(){if(null===this.processed)return null;if(void 0===this.processed)return this.extractSudokuImage(),this.extractDigits();for(var e=y(this.processed.colour,this.config.rows,this.config.columns),t=y(this.processed.binary,this.config.rows,this.config.columns),r=[],n=0;n<this.config.rows;n++){for(var c=[],i=0;i<this.config.columns;i++){var a=e[n][i],o=t[n][i],s=M(a,o);if(s){var u=document.createElement("canvas");c.push(u),cv.imshow(u,s),s.delete()}else c.push(null);a.delete(),o.delete()}r.push(c)}return r}},{key:"destruct",value:function(){this.processed?(this.processed.colour.delete(),this.processed.binary.delete()):(this.original.delete(),this.source.delete())}},{key:"preprocessImage",value:function(){var e=this.config.preprocess,t=e.blurRadius,r=e.thresholdBlur,n=e.thresholdNorm;cv.cvtColor(this.source,this.source,cv.COLOR_RGBA2GRAY,0);var c=new cv.Size(t,t);cv.GaussianBlur(this.source,this.source,c,0,0,cv.BORDER_DEFAULT),cv.adaptiveThreshold(this.source,this.source,255,cv.ADAPTIVE_THRESH_MEAN_C,cv.THRESH_BINARY,r,n)}},{key:"findLargestSquare",value:function(){var e=new cv.MatVector,t=new cv.Mat;cv.findContours(this.source,e,t,cv.RETR_TREE,cv.CHAIN_APPROX_SIMPLE);for(var r=0,n=null,c=0;c<e.size();c++){var i=e.get(c),a=x(i);if(O(a,this.source,this.config.minSize,this.config.maxSize)){var o=cv.contourArea(a);o>r&&(r=o,n=a.clone())}i.delete(),a.delete()}return e.delete(),t.delete(),n}}]),e}(),_=r(15),R={width:{ideal:4096},height:{ideal:2160},facingMode:{ideal:"environment"},focusMode:{ideal:"continuous"},whiteBalance:{ideal:"continuous"},exposureMode:{ideal:"continuous"}},S=function(){var e=Object(l.a)(h.a.mark((function e(){var t,r,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:if(t=e.sent,(r=t.filter((function(e){return"videoinput"===e.kind}))).length){e.next=6;break}throw new Error("No camera found.");case 6:return n=r.filter((function(e){return e.label.includes("facing back")})),e.abrupt("return",n.length?n[n.length-1]:null);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(l.a)(h.a.mark((function e(t,r){var n,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S();case 2:return n=e.sent,c={video:Object(f.a)(Object(f.a)({},R),{},{deviceId:(null===n||void 0===n?void 0:n.deviceId)?n.deviceId:void 0},r&&{width:{ideal:r.width},height:{ideal:r.height}}),audio:!1},e.next=6,navigator.mediaDevices.getUserMedia(c);case 6:return t.srcObject=e.sent,e.next=9,t.play();case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),E=r(1);function I(){var e=Object(n.useRef)(null),t=Object(n.useRef)(null),r=Object(n.useRef)(0),c=Object(n.useCallback)((function(e,n){var i=function(e){var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var r=t.getContext("2d");return r?(r.drawImage(e,0,0),r.getImageData(0,0,t.width,t.height)):null}(e);if(i&&t.current){var a=new C(i);a.extractSudokuImage(t.current),a.destruct()}r.current=requestAnimationFrame((function(){return c(e,n)}))}),[]);return Object(n.useEffect)((function(){if(!e.current||!t.current)return function(){};var n=e.current,i=t.current;return function(){var e=Object(l.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(n,{width:500,height:500});case 2:c(n,i);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),Object(l.a)(h.a.mark((function e(){var t,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new _.a,e.next=3,t.load();case 3:return e.next=5,t.extractSingle("7.png");case 5:r=e.sent,t.destruct(),console.log("extracted",r);case 8:case"end":return e.stop()}}),e)})))(),function(){cancelAnimationFrame(r.current),n.srcObject.getVideoTracks()[0].stop()}}),[c]),Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("h1",{children:"\ud83e\uddee Sudoku Solver"}),Object(E.jsx)("video",{ref:e,muted:!0,playsInline:!0}),Object(E.jsx)("canvas",{ref:t}),Object(E.jsx)("table",{id:"grid1"})]})}function P(){var e=Object(n.useState)(!0),t=Object(o.a)(e,2),r=t[0],c=t[1];return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("button",{style:{position:"fixed",top:"10px",left:"10px"},onClick:function(){return c(!r)},type:"button",children:r?"mount":"unmout"}),Object(E.jsx)(s.a,{onLoad:function(){return c(!1)},openCvPath:"".concat("/sudoku-solver","/opencv.js"),children:r?Object(E.jsx)("i",{children:"Loading..."}):Object(E.jsx)(I,{})})]})}var F=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,72)).then((function(t){var r=t.getCLS,n=t.getFID,c=t.getFCP,i=t.getLCP,a=t.getTTFB;r(e),n(e),c(e),i(e),a(e)}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(E.jsx)(c.a.StrictMode,{children:Object(E.jsx)(P,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),F()}},[[71,1,2]]]);
//# sourceMappingURL=main.fbdc26d1.chunk.js.map